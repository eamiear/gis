define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/array","extras/basic/Radical","extras/controls/ToolBar"],function(r,e,t,i,a){return r(i,{className:"LayerQuery",constructor:function(r){this.queryLayer=this.createLayer({layerId:this.defaultLayerIds.queryLayerId}),this.toolbar=new a(r)},initLayerQuery:function(r){this.toolbar=r,this.map=this.toolbar.map,this.map.addLayer(this.layerQueryLayer)},drawToSearch:function(r,e){return e&&this.queryLayer.clear(),this.map.reorderLayer(this.queryLayer,this.map._layers.length-1),this.toolbar.draw(r)},domainSearch:function(r,t){var i={type:"polygon",extras:{type:"search"},layerId:this.defaultLayerIds.queryDrawLayerId};return e.mixin(i,r),this.drawToSearch(i,t||!0).then(dojo.hitch(this,function(e,t){t.clear(),this.queryLayer.add(e),dojo.publish(r.subscribeHook||"domainsearch",[e])}))},pullBoxSearch:function(r){return this.domainSearch(e.mixin({type:esri.toolbars.draw.EXTENT,subscribeHook:"pullBoxSearchFinish"},r||{}))},polygonSearch:function(r){return this.domainSearch(e.mixin({type:esri.toolbars.draw.POLYGON,subscribeHook:"polygonSearchFinish"},r||{}))},lineSearch:function(r){return this.domainSearch(e.mixin({type:esri.toolbars.draw.FREEHAND_POLYLINE,subscribeHook:"lineSearchFinish"},r||{}))},circleSearch:function(){return this.domainSearch(e.mixin({type:esri.toolbars.draw.CIRCLE,subscribeHook:"circleSearchFinish"},options||{}))},getGraphicBy:function(r,e,i){if(!(r=this.getLayerById(r)))return void this.logger("layer doesn't exist");var a=r.graphics||[];return t.filter(a,function(r){return r[e]==i})[0]},queryByAttribute:function(r,e,t,i){var a=this.getLayerById(r);return a?this._getGraphicByAttribute(a,e,t,i):void this.logger("[queryByAttribute]","layer doesn't exist!")},queryByGeometry:function(r,e){var t=this.getLayerById(r);return t?this._getGraphicByGeometry(t,e):void this.logger("[queryByGeometry]","layer doesn't exist!")},queryByAttributeAndGeometry:function(r,e,t,i,a){var o=this.getLayerById(r);return o?this._getGraphicByAttributeAndGeometry(o,e,t,i,a):void this.logger("[queryByAttributeAndGeometry]","layer doesn't exist!")},getAllGraphics:function(r){return(r=this.getLayerById(r))&&r.graphics},_getGraphicByAttributeAndGeometry:function(r,e,i,a,o){var n=this.getGraphicByAttribute(r,i,a,o)||[];return t.map(n,function(r){return e.contains(r.geometry)})},_getGraphicByGeometry:function(r,e){var i=this.getAllGraphics(r);return i&&e?t.map(i,function(r){return e.contains(r.geometry)}):void this.logger("graphics or geometry doesn't exist!")},_getGraphicByAttribute:function(r,e,i,a){var o=r.graphics||[];return t.map(o,function(r){if(r&&r.attributes)return!a&&r.attributes[e]==i||-1!=r.attributes[e].indexOf(i)})},clear:function(){this.clearLayer(this.queryLayer)}})});